<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DYSA Point - Dashboard Cajera</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            font-size: 14px;
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 40px;
            margin-bottom: 15px;
            color: #4CAF50;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }

        .ventas-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .ventas-table th,
        .ventas-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .ventas-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .estado-abierta {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .estado-cerrada {
            background: #fff3e0;
            color: #f57c00;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .quick-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .quick-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-info">
                <div>
                    <h1><i class="fas fa-cash-register"></i> Dashboard Cajera</h1>
                    <div class="user-info">DYSA Point Enterprise - Sistema POS</div>
                </div>
                <div class="user-info">
                    <strong>Usuario:</strong> <span id="userName">Cajera</span><br>
                    <strong>Turno:</strong> <span id="currentShift">Día</span>
                </div>
            </div>
        </div>

        <!-- Estadísticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                <div class="stat-value" id="ventasHoy">$0</div>
                <div class="stat-label">Ventas Hoy</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-receipt"></i></div>
                <div class="stat-value" id="ticketsHoy">0</div>
                <div class="stat-label">Tickets Hoy</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                <div class="stat-value" id="ventasAbiertas">0</div>
                <div class="stat-label">Ventas Abiertas</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                <div class="stat-value" id="ticketPromedio">$0</div>
                <div class="stat-label">Ticket Promedio</div>
            </div>
        </div>

        <!-- Botones de Acción -->
        <div class="action-buttons">
            <button class="action-btn" onclick="nuevaVenta()">
                <i class="fas fa-plus"></i> Nueva Venta
            </button>
            <button class="action-btn" onclick="cobrarVenta()">
                <i class="fas fa-credit-card"></i> Cobrar Venta
            </button>
            <button class="action-btn" onclick="consultarPrecio()">
                <i class="fas fa-search"></i> Consultar Precio
            </button>
            <button class="action-btn" onclick="abrirCaja()">
                <i class="fas fa-cash-register"></i> Abrir Caja
            </button>
        </div>

        <div class="content-grid">
            <!-- Contenido Principal -->
            <div class="main-content">
                <h2 class="card-title">
                    <i class="fas fa-list"></i>
                    Ventas Recientes
                </h2>

                <div class="alert">
                    <i class="fas fa-info-circle"></i>
                    <strong>Información:</strong> Panel de cajera en desarrollo. Funcionalidades básicas implementadas.
                </div>

                <table class="ventas-table">
                    <thead>
                        <tr>
                            <th>Ticket #</th>
                            <th>Mesa</th>
                            <th>Total</th>
                            <th>Estado</th>
                            <th>Hora</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="ventasTableBody">
                        <tr>
                            <td>001</td>
                            <td>Mesa 5</td>
                            <td>$25,500</td>
                            <td><span class="estado-abierta">ABIERTA</span></td>
                            <td>14:30</td>
                            <td>
                                <button class="quick-btn">Ver</button>
                                <button class="quick-btn">Cobrar</button>
                            </td>
                        </tr>
                        <tr>
                            <td>002</td>
                            <td>Mesa 3</td>
                            <td>$18,900</td>
                            <td><span class="estado-cerrada">CERRADA</span></td>
                            <td>14:15</td>
                            <td>
                                <button class="quick-btn">Ver</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Estado de Caja -->
                <div class="sidebar-card">
                    <h3 class="card-title">
                        <i class="fas fa-cash-register"></i>
                        Estado de Caja
                    </h3>
                    <p><strong>Caja:</strong> <span id="cajaEstado">Abierta</span></p>
                    <p><strong>Saldo Inicial:</strong> $<span id="saldoInicial">100,000</span></p>
                    <p><strong>Ventas:</strong> $<span id="totalVentas">245,500</span></p>
                    <p><strong>Saldo Actual:</strong> $<span id="saldoActual">345,500</span></p>

                    <div class="quick-actions">
                        <button class="quick-btn" onclick="corteCaja()">Corte Caja</button>
                        <button class="quick-btn" onclick="cerrarCaja()">Cerrar</button>
                    </div>
                </div>

                <!-- Métodos de Pago -->
                <div class="sidebar-card">
                    <h3 class="card-title">
                        <i class="fas fa-credit-card"></i>
                        Métodos de Pago Hoy
                    </h3>
                    <p><strong>Efectivo:</strong> $180,000</p>
                    <p><strong>Tarjeta:</strong> $125,500</p>
                    <p><strong>Transferencia:</strong> $45,000</p>

                    <div class="quick-actions">
                        <button class="quick-btn" onclick="verDetalles()">Ver Detalles</button>
                    </div>
                </div>

                <!-- Accesos Rápidos -->
                <div class="sidebar-card">
                    <h3 class="card-title">
                        <i class="fas fa-bolt"></i>
                        Accesos Rápidos
                    </h3>
                    <div class="quick-actions" style="flex-direction: column;">
                        <button class="quick-btn" onclick="window.open('/reportes', '_blank')">
                            <i class="fas fa-chart-bar"></i> Reportes
                        </button>
                        <button class="quick-btn" onclick="window.open('/productos', '_blank')">
                            <i class="fas fa-box"></i> Productos
                        </button>
                        <button class="quick-btn" onclick="window.open('/admin', '_blank')">
                            <i class="fas fa-cog"></i> Admin
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../terminal/js/api-client.js"></script>
    <script>
        // Variables globales
        let currentUser = null;

        // Inicialización
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Iniciando Dashboard Cajera...');

            try {
                await verifyAuth();
                await loadDashboardData();
                setupEventListeners();

                console.log('✅ Dashboard Cajera iniciado correctamente');
            } catch (error) {
                console.error('❌ Error inicializando dashboard:', error);
                alert('Error al cargar el dashboard. Verifique su conexión.');
            }
        });

        // Verificar autenticación
        async function verifyAuth() {
            const token = localStorage.getItem('dysa_token');
            if (!token) {
                window.location.href = '/terminal';
                return;
            }

            try {
                const response = await apiClient.post('/auth/verify', { token });
                if (response.success) {
                    currentUser = response.data.empleado;
                    updateUserInfo();
                } else {
                    throw new Error('Token inválido');
                }
            } catch (error) {
                console.error('Error verificando autenticación:', error);
                localStorage.removeItem('dysa_token');
                window.location.href = '/terminal';
            }
        }

        // Actualizar información del usuario
        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userName').textContent =
                    `${currentUser.nombre} ${currentUser.apellido}`;
            }
        }

        // Cargar datos del dashboard
        async function loadDashboardData() {
            try {
                // Simular datos por ahora - después conectar con APIs reales
                await new Promise(resolve => setTimeout(resolve, 500));

                // Actualizar estadísticas
                document.getElementById('ventasHoy').textContent = '$245,500';
                document.getElementById('ticketsHoy').textContent = '28';
                document.getElementById('ventasAbiertas').textContent = '3';
                document.getElementById('ticketPromedio').textContent = '$8,768';

                console.log('✅ Datos del dashboard cargados');
            } catch (error) {
                console.error('❌ Error cargando datos:', error);
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Aquí se pueden agregar más listeners
        }

        // Funciones de acción
        function nuevaVenta() {
            window.open('/pos', '_blank');
        }

        function cobrarVenta() {
            alert('Función de cobro en desarrollo');
        }

        function consultarPrecio() {
            alert('Función de consulta de precios en desarrollo');
        }

        function abrirCaja() {
            alert('Función de apertura de caja en desarrollo');
        }

        function corteCaja() {
            alert('Función de corte de caja en desarrollo');
        }

        function cerrarCaja() {
            if (confirm('¿Está seguro de cerrar la caja?')) {
                alert('Función de cierre de caja en desarrollo');
            }
        }

        function verDetalles() {
            alert('Ver detalles de métodos de pago');
        }

        // Funciones auxiliares
        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-CL', {
                style: 'currency',
                currency: 'CLP'
            }).format(amount);
        }

        function formatTime(date) {
            return new Date(date).toLocaleTimeString('es-CL', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Actualizar datos cada 30 segundos
        setInterval(loadDashboardData, 30000);
    </script>
</body>
</html>